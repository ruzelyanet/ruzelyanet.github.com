'use strict';

Object.defineProperty(exports, "__esModule", {
	value: true
});

var _fs = require('fs');

var _fs2 = _interopRequireDefault(_fs);

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _isDirectory = require('is-directory');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var isPng = function isPng(fp) {
	return !!/\.png$/i.test(fp);
};

var isSpriteDir = function isSpriteDir(dir) {
	return function (fp) {
		return (0, _isDirectory.sync)(_path2.default.join(dir, fp));
	};
};

var hasPngInSpriteDir = function hasPngInSpriteDir(dir) {
	return function (fp) {
		var file = _path2.default.join(dir, fp);
		return !(0, _isDirectory.sync)(file) && isPng(file);
	};
};

var hasIconsInSpriteDir = function hasIconsInSpriteDir(dir, spritesPath) {
	return function (fp) {
		var folder = _path2.default.join(dir, fp);

		if (!(0, _isDirectory.sync)(folder)) {
			return false;
		};

		var files = _fs2.default.readdirSync(folder);

		if (!files.length) {
			console.warn('[sprites] Put icons to \'' + spritesPath + '/' + _path2.default.basename(folder) + '\' or delete this folder.');
			return false;
		}

		return !!files.filter(hasPngInSpriteDir(folder)).length;
	};
};

exports.default = function () {
	var cwd = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : process.cwd();
	var spritesPath = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'app/sprites';

	var dir = _path2.default.join(cwd, spritesPath);
	var hasSpritesDir = (0, _isDirectory.sync)(dir);

	if (!hasSpritesDir) {
		return false;
	}

	var spritesDirFiles = _fs2.default.readdirSync(dir);
	var hasIconsInSpritesDir = !!spritesDirFiles.filter(isPng).length;

	if (hasIconsInSpritesDir) {
		console.warn('[sprites] Move icons from \'' + spritesPath + '\' to \'' + spritesPath + '/<name>\' or delete them.');
		return false;
	}

	var hasIconsInSpriteDirs = !!spritesDirFiles.filter(hasIconsInSpriteDir(dir, spritesPath)).length;

	if (!hasIconsInSpriteDirs) {
		return false;
	}

	return true;
};